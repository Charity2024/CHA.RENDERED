<!DOCTYPE html>
<html lang="en" data-mode="space-nerd">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CELESTIA™ | Kinetic Deep Verse</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono&display=swap');

        :root {
            --bg: #010208; --star-color: #ffffff; --accent: #38bdf8;
            --nebula-1: rgba(56, 189, 248, 0.12);
            --nebula-2: rgba(139, 92, 246, 0.12);
            --glass-bg: rgba(255, 255, 255, 0.02);
            --glass-border: rgba(255, 255, 255, 0.08);
            --font: 'Inter', sans-serif;
        }

        [data-mode="engineer"] { --bg: #000; --star-color: #00ff41; --accent: #00ff41; --nebula-1: rgba(0, 255, 65, 0.08); --nebula-2: rgba(0, 40, 10, 0.15); --font: 'JetBrains Mono', monospace; }
        [data-mode="creative"] { --bg: #080110; --star-color: #ff00ea; --accent: #00f2ff; --nebula-1: rgba(255, 0, 234, 0.12); --nebula-2: rgba(0, 242, 255, 0.08); }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { width: 100%; height: 100%; overflow: hidden; background: var(--bg); color: var(--star-color); font-family: var(--font); transition: background 2s; cursor: none; }

        canvas { position: fixed; inset: 0; display: block; width: 100vw; height: 100vh; z-index: 1; pointer-events: none; }
        #universe-svg { position: fixed; inset: 0; width: 100%; height: 100%; z-index: 5; pointer-events: none; }
        
        .overlay { position: fixed; inset: 0; pointer-events: none; z-index: 10; padding: 40px; display: flex; flex-direction: column; justify-content: space-between; opacity: 0; }
        
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
        }

        .header-glass { display: flex; gap: 8px; padding: 10px 20px; pointer-events: all; width: fit-content; align-self: center; }
        .mode-btn { cursor: pointer; font-size: 0.55rem; letter-spacing: 0.4em; text-transform: uppercase; opacity: 0.3; transition: 0.4s; padding: 8px 16px; border-radius: 12px; }
        .mode-btn.active { opacity: 1; color: var(--accent); background: rgba(255,255,255,0.03); }

        #panel {
            position: fixed; right: 30px; top: 30px; bottom: 30px; width: 100%; max-width: 440px; 
            padding: 60px; z-index: 20; transform: translateX(130%); 
            transition: transform 1.2s cubic-bezier(0.16, 1, 0.3, 1);
        }
        #panel.visible { transform: translateX(0); }

        #custom-cursor {
            position: fixed; width: 24px; height: 24px; border: 1px solid var(--accent);
            border-radius: 50%; pointer-events: none; z-index: 9999;
            mix-blend-mode: difference;
        }

        #arrival-scrim {
            position: fixed; inset: 0; background: #000; z-index: 2000; 
            display: flex; align-items: center; justify-content: center;
            pointer-events: all; transition: opacity 2s;
        }

        footer { font-size: 0.5rem; letter-spacing: 0.5em; opacity: 0.3; display: flex; justify-content: space-between; mix-blend-mode: difference; }
    </style>
</head>
<body>

    <div id="arrival-scrim" onclick="beginArrival()">
        <div style="letter-spacing: 1.2em; font-size: 0.7rem; opacity: 0.6; cursor: pointer;">ACTIVATE_TRAVEL_CORE</div>
    </div>

    <div id="custom-cursor"></div>
    <canvas id="main-canvas"></canvas>

    <div class="overlay" id="main-ui">
        <header class="header-glass glass">
            <div class="mode-btn active" onclick="setMode('space-nerd', this)">Space</div>
            <div class="mode-btn" onclick="setMode('engineer', this)">Engineer</div>
            <div class="mode-btn" onclick="setMode('creative', this)">Creative</div>
        </header>
        <footer style="margin-top: auto;">
            <div>TRAVEL_VELOCITY: <span id="vel-val">0.0c</span></div>
            <div>DEEP_VERSE_LENSING_V3</div>
            <div>© CELESTIA™ // 2026</div>
        </footer>
    </div>

    <div id="panel" class="glass">
        <div onclick="closePanel()" style="cursor:pointer; font-size: 0.55rem; opacity: 0.3; margin-bottom: 50px;">[ BREAK_ORBIT ]</div>
        <h2 id="p-title" style="font-size: 2.2rem; font-weight: 300; margin-bottom: 20px;"></h2>
        <div id="p-meta" style="font-size: 0.6rem; letter-spacing: 0.4em; margin-bottom: 40px; color: var(--accent);"></div>
        <p id="p-desc" style="line-height: 2.2; font-size: 1.05rem; opacity: 0.6; font-weight: 300;"></p>
    </div>

    <svg id="universe-svg">
        <g id="links-group" opacity="0.4"></g>
        <g id="stars-group" pointer-events="all"></g>
    </svg>

    <script>
        const PROJECTS = [
            { id: 1, title: "Neural Shell", pos: { "space-nerd": [25, 30], engineer: [15, 20], creative: [10, 60] }, desc: "Architecting synthetic cognition pathways.", meta: "AI_SINGULARITY", links: [2, 3] },
            { id: 2, title: "Void Ledger", pos: { "space-nerd": [75, 50], engineer: [15, 50], creative: [85, 25] }, desc: "Quantum-scale distributed ledger orchestration.", meta: "MESH_LEDGER", links: [1, 3] },
            { id: 3, title: "Aether Engine", pos: { "space-nerd": [45, 85], engineer: [15, 80], creative: [50, 40] }, desc: "Volumetric light synthesis in browser environments.", meta: "VFX_CORE", links: [1, 2] }
        ];

        const canvas = document.getElementById('main-canvas');
        const ctx = canvas.getContext('2d');
        const starsG = document.getElementById('stars-group');
        const linksG = document.getElementById('links-group');
        const cursor = document.getElementById('custom-cursor');

        let width, height, currentMode = 'space-nerd';
        let zoom = 0.01; let targetZoom = 0.01;
        let particles = [], nebulas = [], rays = [], dataWorlds = [], focusedPlanet = null;
        let cameraOffset = { x: 0, y: 0 };
        let mouse = { x: -1000, y: -1000 };
        let isArrived = false;
        let velocity = 0;

        class DataWorld {
            constructor(project) {
                this.project = project;
                this.pillars = Array.from({length: 40}, () => Math.random() * 250 + 50);
            }
        }

        class NebulaCloud {
            constructor() {
                this.x = (Math.random() - 0.5) * 6000;
                this.y = (Math.random() - 0.5) * 6000;
                this.r = Math.random() * 1800 + 900;
            }
        }

        function beginArrival() {
            document.getElementById('arrival-scrim').style.opacity = '0';
            setTimeout(() => document.getElementById('arrival-scrim').remove(), 2000);
            gsap.to(window, {
                duration: 4, onUpdate: () => { targetZoom = 130; },
                ease: "power4.inOut",
                onComplete: () => {
                    isArrived = true;
                    gsap.to('#main-ui', { opacity: 1, duration: 1.5 });
                }
            });
        }

        function setup() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            particles = Array.from({length: 800}, () => ({
                originX: (Math.random()-0.5)*7000, originY: (Math.random()-0.5)*7000, z: Math.random()*3500, size: Math.random() * 1.5 + 0.5
            }));
            nebulas = Array.from({length: 8}, () => new NebulaCloud());
            dataWorlds = PROJECTS.map(p => new DataWorld(p));
            renderDeepVerse();
            setMode('space-nerd', document.querySelector('.mode-btn'));
        }

        function renderDeepVerse() {
            starsG.innerHTML = '';
            linksG.innerHTML = '';
            PROJECTS.forEach(p => {
                p.links.forEach(targetId => {
                    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    line.id = `link-${p.id}-${targetId}`;
                    line.setAttribute("stroke-width", "1");
                    line.setAttribute("stroke-dasharray", "5,10");
                    linksG.appendChild(line);
                });
            });
            PROJECTS.forEach((p) => {
                const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
                const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                c.setAttribute("r", "25");
                c.style.fill = "white";
                c.style.cursor = "pointer";
                g.appendChild(c);
                starsG.appendChild(g);
                g.addEventListener('click', () => travelToNode(p));
            });
        }

        function travelToNode(p) {
            focusedPlanet = p;
            targetZoom = 3500;
            openPanel(p);
            // Visual Velocity Feedback
            gsap.to(window, { duration: 1, onUpdate: () => { velocity = 0.9; }, onComplete: () => { velocity = 0; } });
        }

        function setMode(mode, btn) {
            currentMode = mode;
            document.documentElement.setAttribute('data-mode', mode);
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            PROJECTS.forEach(p => p.targetHome = [p.pos[mode][0] * 10, p.pos[mode][1] * 10]);
        }

        function applyLens(x, y) {
            if (!isArrived) return { x, y };
            const dx = x - mouse.x;
            const dy = y - mouse.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            const radius = 300;
            if (dist < radius) {
                const power = (1 - dist/radius) * 50;
                return { x: x + (dx/dist) * power, y: y + (dy/dist) * power };
            }
            return { x, y };
        }

        function animate() {
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--bg');
            ctx.fillRect(0, 0, width, height);
            const accent = getComputedStyle(document.documentElement).getPropertyValue('--accent');

            zoom += (targetZoom - zoom) * 0.05;
            document.getElementById('vel-val').innerText = (velocity * 9.9).toFixed(1) + 'c';

            if(focusedPlanet) {
                cameraOffset.x += (focusedPlanet.targetHome[0] - 500 - cameraOffset.x) * 0.08;
                cameraOffset.y += (focusedPlanet.targetHome[1] - 500 - cameraOffset.y) * 0.08;
            } else {
                cameraOffset.x *= 0.95; cameraOffset.y *= 0.95;
            }

            const nodeScreenPos = PROJECTS.map(p => {
                const sZoom = zoom / 120;
                let rx = width/2 + (p.targetHome[0] - 500 - cameraOffset.x) * sZoom;
                let ry = height/2 + (p.targetHome[1] - 500 - cameraOffset.y) * sZoom;
                return { ...p, ...applyLens(rx, ry), sZoom };
            });

            // Update Links and Star Nodes
            PROJECTS.forEach((p, idx) => {
                const start = nodeScreenPos[idx];
                p.links.forEach(tId => {
                    const end = nodeScreenPos[PROJECTS.findIndex(tp => tp.id === tId)];
                    const line = document.getElementById(`link-${p.id}-${tId}`);
                    if (line) {
                        line.setAttribute("x1", start.x); line.setAttribute("y1", start.y);
                        line.setAttribute("x2", end.x); line.setAttribute("y2", end.y);
                        line.setAttribute("stroke", accent);
                        line.style.opacity = (1 - (zoom/3000)) * 0.4;
                    }
                });
                if (starsG.children[idx]) {
                    gsap.set(starsG.children[idx].querySelector('circle'), { 
                        attr: { cx: start.x, cy: start.y, r: 25 * Math.max(0.05, start.sZoom/4) },
                        opacity: 1 - (zoom/3500)
                    });
                }
            });

            // Kinetic Starfield (Bloating effect during travel)
            ctx.fillStyle = "white";
            particles.forEach(s => {
                const sZoom = zoom / (s.z / 700);
                let px = width/2 + (s.originX - cameraOffset.x * sZoom) * (zoom/120);
                let py = height/2 + (s.originY - cameraOffset.y * sZoom) * (zoom/120);
                const lp = applyLens(px, py);
                ctx.globalAlpha = Math.max(0.05, Math.min(0.4, sZoom/2) * (1 - (zoom/4500)));
                
                // Stretch stars if moving fast
                const stretch = velocity * 50;
                ctx.fillRect(lp.x, lp.y, 1.2, 1.2 + stretch);
            });

            if(zoom > 1800 && focusedPlanet) {
                drawGlassTerrain(dataWorlds.find(dw => dw.project.id === focusedPlanet.id), accent);
            }

            requestAnimationFrame(animate);
        }

        function drawGlassTerrain(world, color) {
            const step = width / world.pillars.length;
            const progress = Math.min(1, (zoom - 1800) / 1200);
            ctx.globalAlpha = progress;
            world.pillars.forEach((h, i) => {
                const x = i * step; const y = height - (h * progress);
                ctx.fillStyle = `rgba(255, 255, 255, 0.02)`; ctx.fillRect(x, y, step - 2, h);
                ctx.fillStyle = color; ctx.fillRect(x, y, step - 2, 2);
            });
        }

        function openPanel(p) {
            document.getElementById('p-title').innerText = p.title;
            document.getElementById('p-meta').innerText = p.meta;
            document.getElementById('p-desc').innerText = p.desc;
            document.getElementById('panel').classList.add('visible');
        }

        function closePanel() {
            document.getElementById('panel').classList.remove('visible');
            focusedPlanet = null; targetZoom = 130;
        }

        window.addEventListener('mousemove', e => {
            mouse.x = e.clientX; mouse.y = e.clientY;
            gsap.to(cursor, { x: e.clientX - 12, y: e.clientY - 12, duration: 0.1 });
        });

        window.addEventListener('resize', setup);
        setup(); animate();
    </script>
</body>
</html>